---
title: "MATH 216 Homework 1"
author: "Connor McCormick"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    smooth_scroll: false
---

```{r, echo=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
# For read_csv() command, which is an improved version of base R's read.csv()
library(readr) 
library(lubridate)

# Load data sets. Note this assumes this .Rmd files is in the same directory as
# the .csv files.
flights <- read_csv("data/flights.csv") %>% 
  mutate(date=as.Date(date))
weather <- read_csv("data/weather.csv") %>% 
  mutate(date=as.Date(date))
planes <- read_csv("data/planes.csv")
airports <- read_csv("data/airports.csv")
states <- read_csv("data/states.csv")
```





## Admistrative:

Please indicate

* Who you collaborated with:
* Roughly how much time you spent on this HW so far:
* The URL of the RPubs published URL [here](https://www.nhl.com/).
* What gave you the most trouble:
* Any comments you have:





## Question 1:

Plot a "time series" of the proportion of flights that were delayed by > 30 minutes on each day.  i.e.
 
* the x-axis should be some notion of time
* the y-axis should be the proportion.

Using this plot, indicate describe the
[seasonality](https://en.wikipedia.org/wiki/Seasonality) of when delays over 30
minutes tend to occur.

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}

flights_per_day <- flights %>% 
  group_by(date) %>% 
  tally() %>% 
  rename(flights_per_day = n)
flights_per_day

delays_per_day <- flights %>% 
  filter(!is.na(dep_delay)) %>%
  group_by(date, actual_delay = dep_delay>=30) %>% 
  select(date, actual_delay) %>%
  filter(actual_delay==TRUE) %>%
  tally() %>% 
  rename(delays_per_day = n)
delays_per_day

delays_per_day <- left_join(delays_per_day, flights_per_day, by="date") %>%
  mutate(prop = round(delays_per_day/flights_per_day,3))
  

ggplot(delays_per_day, aes(x=date, y=prop)) +
  geom_point() +
  geom_smooth(se=FALSE) +
  labs(title="Seasonality", x='Date', y='Proportion of Cancelled Flights')


```





## Question 2:

Some people prefer flying on older planes.  Even though they aren't as nice,
they tend to have more room.  Which airlines should these people favor?

```{r, echo=FALSE, fig.width=12, fig.height=6}

oldplanes <- planes %>%
  select(plane, year) %>%
  arrange(year) 

oldairlines <- flights %>%
  select(carrier, plane) %>%
  arrange (carrier)

oldplanes <- oldairlines %>%
  left_join(oldplanes, oldairlines, by = "plane") %>%
  filter(!is.na(year))

oldplanes <- oldplanes %>%
    group_by(carrier) %>%
    summarize(meanyear=mean(year), medianyear=median(year))
  

ggplot(data=oldplanes, aes(x=meanyear, y=medianyear, fill = carrier)) +
  geom_point() 



```





## Question 3:

* What states did Southwest Airlines' **flight paths** tend to fly to?
* What states did Southwest Airlines' **flights** tend to fly to?

For example, Southwest Airlines Flight 60 to Dallas consists of a single flight
path, but since it flew 299 times in 2013, it would be counted as 299 flights.

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}

southwest <- flights %>%
  group_by(carrier) %>%
  filter(carrier=='WN')

airport_local <- left_join(airports, states, by="state")

southwest <- left_join(southwest, airport_local, by = c("dest"="iata")) %>%
  filter(cancelled==0) %>%
  select(state, flight, dest, plane, airport, city, date) %>%
  group_by(state)

totalflights <- southwest %>% 
  group_by(state) %>% 
  tally() %>% 
  rename(totalflights = n)
totalflights

flightpaths <- southwest %>% 
  group_by(state, flight) %>% 
  summarize(length(state)) %>%
  tally() %>% 
  rename(flightpaths = n)
flightpaths


ggplot(totalflights, aes(x=state, y=totalflights)) +
  geom_bar(stat="identity", position="dodge") +
  labs(title="Flights by State", x="State", y="Number of Flights")

ggplot(flightpaths, aes(x=state, y=flightpaths)) +
  geom_bar(stat="identity", position="dodge") +
  labs(title="Flightpaths by State", x="State", y="Number of Flightpaths")


```





## Question 4:

I want to know proportionately what regions (NE, south, west, midwest) each 
carrier flies to/from Houston in the month of July.  Consider the `month()`
function from the `lubridate` package.

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}

airport_local <- left_join(airports, states, by="state")

fullflight <- left_join(airport_local, flights, by=c("iata" = "dest")) %>%
    filter(!is.na(plane) & cancelled==0)

houston <- fullflight %>%
  select(carrier, iata, region, date) %>%
  group_by(carrier, region) %>%
  arrange(carrier)

houston <- houston %>%
  mutate(month=month(date)) %>%
  filter(month==7)

carrier_totals <- houston %>% 
  group_by(carrier) %>% 
  tally() %>% 
  rename(carrier_totals = n)
carrier_totals

carrier_region <- houston %>% 
  filter(!is.na(region)) %>%
  group_by(carrier, region) %>% 
  tally() %>% 
  rename(carrier_region = n)
carrier_region

carrier_region <- left_join(carrier_region, carrier_totals, by="carrier") %>%
  mutate(prop = round(carrier_region/carrier_totals,3))
  
ggplot(carrier_region, aes(x=region, y=prop, fill=carrier)) +
  geom_bar(stat="identity", position="dodge")+
  facet_wrap(~carrier)


```
